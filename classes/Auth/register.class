<?php
    class RegisterUser{
        private $conn;

        public function __construct($db) {
            $this->conn = $db;
        }

        public function create($request){
            $username = trim($request['username']);
            $email = trim($request['email']);
            $password = password_hash($request['password'], PASSWORD_BCRYPT);
            $sql = "INSERT INTO users(username, email, password) VALUES (:username, :email, :password)";
            try {
                $stmt = $this->conn->prepare($sql);
                $result = $stmt->execute(['username' => $username, 'email' => $email, 'password' => $password]);
                if ($result) {
                    return 'success';
                } else {
                    return 'failed';
                }
            } catch (PDOException $e) {
                error_log('Database error: ' . $e->getMessage());
                return 'error';
            }
        }
        public function checkAccount($request) {
            $username = trim($request['username']);
            $sql = "SELECT * FROM users WHERE username = :username";
            
            try {
                $stmt = $this->conn->prepare($sql);
                // Bind the username parameter
                $stmt->bindParam(':username', $username, PDO::PARAM_STR);
                $stmt->execute();

                // Fetch the result
                $result = $stmt->fetch(PDO::FETCH_ASSOC);

                return $result;
            } catch (PDOException $e) {
                // Log and return a generic error message
                error_log('Database error: ' . $e->getMessage());
                return 'error';
            }
        }

    }
?>